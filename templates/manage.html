{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-8">

    <div class="flex items-center justify-between">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Database Management</h1>
        <span class="px-3 py-1 bg-gray-100 dark:bg-gray-800 rounded-full text-xs font-mono text-gray-500">Total: {{
            animes|length }}</span>
    </div>

    <!-- ì¶”ê°€ í¼ -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg border border-gray-100 dark:border-gray-700">
        <h2 class="text-lg font-bold mb-4 text-brand-600 dark:text-brand-400 flex items-center gap-2">
            <span>Add New Anime</span>
        </h2>
        <form action="/manage/add" method="post" class="flex flex-col sm:flex-row gap-4">
            <div class="flex-1 relative">
                <input type="text" name="name" placeholder="ì• ë‹ˆë©”ì´ì…˜ ì´ë¦„ ì…ë ¥" required
                    class="w-full pl-4 pr-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent transition text-gray-900 dark:text-white placeholder-gray-400">
            </div>
            <button type="submit"
                class="bg-brand-600 hover:bg-brand-700 text-white font-bold px-8 py-3 rounded-xl transition shadow-lg shadow-brand-500/30 whitespace-nowrap">
                ë“±ë¡í•˜ê¸°
            </button>
        </form>
        <p class="text-xs text-gray-400 mt-3 ml-1">* ì´ˆê¸° Elo Ratingì€ 1200ì ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.</p>
    </div>

    <!-- ëª©ë¡ ì˜ì—­ -->
    <div
        class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-100 dark:border-gray-700 overflow-hidden">
        <div class="p-4 border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50">
            <span class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Registered Items</span>
        </div>

        <ul class="divide-y divide-gray-100 dark:divide-gray-700 max-h-[600px] overflow-y-auto custom-scrollbar">
            {% for ani in animes %}
            <li class="p-4 hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors group">

                <!-- ë³´ê¸° ëª¨ë“œ -->
                <div id="view-row-{{ ani.id }}" class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                    <div class="flex items-center gap-3 overflow-hidden">
                        <div class="w-2 h-2 rounded-full bg-brand-400 shrink-0"></div>
                        <span class="font-medium text-gray-800 dark:text-gray-200 truncate text-lg"
                            title="{{ ani.name }}">
                            {{ ani.name }}
                        </span>
                        {% if ani.matches_played < 10 %} <span
                            class="text-[10px] font-bold px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400 border border-yellow-200 dark:border-yellow-800">
                            NEW</span>
                            {% endif %}
                    </div>

                    <div
                        class="flex items-center gap-2 self-end sm:self-auto shrink-0 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity">
                        <!-- ì§‘ì¤‘ í‰ê°€ -->
                        <a href="/battle/focus/{{ ani.id }}"
                            class="px-3 py-1.5 text-xs font-bold rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 dark:bg-blue-900/30 dark:text-blue-300 dark:hover:bg-blue-900/50 transition">
                            Focus
                        </a>
                        <!-- ìˆ˜ì • -->
                        <button onclick="toggleEdit('{{ ani.id }}')"
                            class="px-3 py-1.5 text-xs font-bold rounded-lg bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition">
                            Edit
                        </button>
                        <!-- ì‚­ì œ -->
                        <form action="/manage/delete" method="post" onsubmit="return confirmDelete('{{ ani.name }}')"
                            class="inline">
                            <input type="hidden" name="anime_id" value="{{ ani.id }}">
                            <button type="submit"
                                class="px-3 py-1.5 text-xs font-bold rounded-lg bg-red-50 text-red-600 hover:bg-red-100 dark:bg-red-900/30 dark:text-red-300 dark:hover:bg-red-900/50 transition">
                                Delete
                            </button>
                        </form>
                    </div>
                </div>

                <!-- ìˆ˜ì • ëª¨ë“œ -->
                <form id="edit-row-{{ ani.id }}" action="/manage/edit" method="post"
                    class="hidden flex flex-col sm:flex-row gap-2 w-full animate-fade-in">
                    <input type="hidden" name="anime_id" value="{{ ani.id }}">
                    <input type="text" id="input-name-{{ ani.id }}" name="new_name" value="{{ ani.name }}" required
                        class="flex-1 bg-white dark:bg-gray-900 border border-brand-300 dark:border-brand-600 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-brand-500 outline-none text-gray-900 dark:text-white">
                    <div class="flex gap-2">
                        <button type="submit"
                            class="px-4 py-2 bg-brand-600 hover:bg-brand-500 text-white rounded-lg text-xs font-bold shadow-md">Save</button>
                        <button type="button" onclick="toggleEdit('{{ ani.id }}')"
                            class="px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg text-xs font-bold">Cancel</button>
                    </div>
                </form>

            </li>
            {% else %}
            <li class="p-12 text-center text-gray-400 flex flex-col items-center">
                <span class="text-4xl mb-2">ğŸ“­</span>
                <span>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ„ ì…ë ¥ì°½ì„ í†µí•´ ì¶”ê°€í•´ì£¼ì„¸ìš”.</span>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

<script>
    function confirmDelete(name) {
        return confirm(`âš ï¸ ì‚­ì œ í™•ì¸\n\n'${name}' ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ì ìˆ˜ ê¸°ë¡ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤.`);
    }

    function toggleEdit(id) {
        const viewRow = document.getElementById(`view-row-${id}`);
        const editRow = document.getElementById(`edit-row-${id}`);

        if (viewRow.classList.contains('hidden')) {
            viewRow.classList.remove('hidden');
            editRow.classList.add('hidden');
        } else {
            viewRow.classList.add('hidden');
            editRow.classList.remove('hidden');
            document.getElementById(`input-name-${id}`).focus();
        }
    }
</script>

<style>
    .animate-fade-in {
        animation: fadeIn 0.2s ease-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-5px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
{% endblock %}
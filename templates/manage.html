<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>ì• ë‹ˆë©”ì´ì…˜ ê´€ë¦¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // ì‚­ì œ ì „ í™•ì¸
        function confirmDelete(name) {
            return confirm(`ì •ë§ë¡œ '${name}'ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
        }

        // ìˆ˜ì • ëª¨ë“œ í† ê¸€ í•¨ìˆ˜
        function toggleEdit(id) {
            const viewRow = document.getElementById(`view-row-${id}`);
            const editRow = document.getElementById(`edit-row-${id}`);

            // í´ë˜ìŠ¤ ì œì–´ë¡œ ë³´ì´ê³  ìˆ¨ê¸°ê¸° (Tailwind 'hidden' í´ë˜ìŠ¤ í™œìš©)
            if (viewRow.classList.contains('hidden')) {
                viewRow.classList.remove('hidden');
                editRow.classList.add('hidden');
            } else {
                viewRow.classList.add('hidden');
                editRow.classList.remove('hidden');
                // ì…ë ¥ì°½ì— í¬ì»¤ìŠ¤ ì£¼ê¸°
                document.getElementById(`input-name-${id}`).focus();
            }
        }
    </script>
</head>

<body class="bg-gray-900 text-white min-h-screen p-6 md:p-10">
    <div class="max-w-4xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold">âš™ï¸ ì• ë‹ˆë©”ì´ì…˜ ê´€ë¦¬</h1>
            <a href="/" class="text-blue-400 hover:underline">â† í™ˆìœ¼ë¡œ</a>
        </div>

        <!-- ì¶”ê°€ í¼ -->
        <div class="bg-gray-800 p-6 rounded-lg shadow-lg mb-8 border border-gray-700">
            <h2 class="text-xl font-bold mb-4 text-green-400">ìƒˆ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€</h2>
            <form action="/manage/add" method="post" class="flex gap-4">
                <input type="text" name="name" placeholder="ì• ë‹ˆë©”ì´ì…˜ ì´ë¦„ ì…ë ¥" required
                    class="flex-1 p-3 rounded bg-gray-700 border border-gray-600 focus:outline-none focus:border-green-500 text-white">
                <button type="submit"
                    class="bg-green-600 hover:bg-green-700 px-6 py-3 rounded font-bold transition whitespace-nowrap">
                    ì¶”ê°€
                </button>
            </form>
            <p class="text-gray-500 text-sm mt-2">* ì´ˆê¸° ì ìˆ˜ëŠ” 1200ì ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.</p>
        </div>

        <!-- ëª©ë¡ -->
        <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg border border-gray-700">
            <div class="p-4 bg-gray-700 font-bold border-b border-gray-600 flex justify-between">
                <span>ë“±ë¡ëœ ì• ë‹ˆë©”ì´ì…˜ ëª©ë¡ ({{ animes|length }}ê°œ)</span>
            </div>

            <ul class="divide-y divide-gray-700 max-h-[600px] overflow-y-auto">
                {% for ani in animes %}
                <li class="p-4 hover:bg-gray-750 transition border-b border-gray-700 last:border-0">

                    <!-- 1. ë³´ê¸° ëª¨ë“œ -->
                    <div id="view-row-{{ ani.id }}"
                        class="flex flex-col sm:flex-row sm:justify-between sm:items-center w-full gap-2">

                        <!-- [ì™¼ìª½] ì´ë¦„ ì˜ì—­ (ë±ƒì§€ ì œê±°ë¨) -->
                        <div class="flex items-center overflow-hidden mr-2">
                            <span class="font-medium text-lg truncate text-white" title="{{ ani.name }}">
                                {{ ani.name }}
                            </span>
                        </div>

                        <!-- [ì˜¤ë¥¸ìª½] ë²„íŠ¼ ì˜ì—­ (ë±ƒì§€ ì¶”ê°€ë¨) -->
                        <div class="flex items-center gap-2 shrink-0 self-end sm:self-auto">

                            <!-- [ì´ë™ë¨] í‰ê°€ íšŸìˆ˜ ë±ƒì§€ (ìˆ˜ì • ë²„íŠ¼ ë°”ë¡œ ì™¼ìª½) -->
                            <span
                                class="shrink-0 text-xs font-mono px-2 py-1.5 rounded border mr-1
                {{ 'bg-yellow-900/30 text-yellow-400 border-yellow-600' if ani.matches_played < 10 else 'bg-gray-800 text-gray-500 border-gray-700' }}">
                                {% if ani.matches_played == 0 %}
                                New
                                {% else %}
                                {{ ani.matches_played }}íšŒ
                                {% endif %}
                            </span>

                            <!-- ìˆ˜ì • ë²„íŠ¼ -->
                            <button onclick="toggleEdit('{{ ani.id }}')"
                                class="text-gray-400 hover:text-white px-3 py-1.5 rounded bg-gray-700 hover:bg-gray-600 transition text-sm flex items-center gap-1">
                                <span>âœï¸</span> <span class="hidden md:inline">ìˆ˜ì •</span>
                            </button>

                            <!-- ì§‘ì¤‘ í‰ê°€ -->
                            <a href="/battle/focus/{{ ani.id }}"
                                class="px-3 py-1.5 bg-blue-900/30 hover:bg-blue-600 text-blue-300 hover:text-white rounded border border-blue-800 hover:border-blue-500 transition text-sm flex items-center gap-1">
                                <span>ğŸ¯</span> <span class="hidden md:inline">ì§‘ì¤‘ í‰ê°€</span>
                            </a>

                            <!-- ì‚­ì œ -->
                            <form action="/manage/delete" method="post"
                                onsubmit="return confirmDelete('{{ ani.name }}')" class="inline">
                                <input type="hidden" name="anime_id" value="{{ ani.id }}">
                                <button type="submit"
                                    class="px-3 py-1.5 bg-red-900/30 hover:bg-red-600 text-red-300 hover:text-white rounded border border-red-800 hover:border-red-500 transition text-sm">
                                    ì‚­ì œ
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- 2. ìˆ˜ì • ëª¨ë“œ (ê¸°ì¡´ê³¼ ë™ì¼) -->
                    <form id="edit-row-{{ ani.id }}" action="/manage/edit" method="post"
                        class="hidden flex items-center gap-2 w-full mt-2 sm:mt-0">
                        <input type="hidden" name="anime_id" value="{{ ani.id }}">
                        <input type="text" id="input-name-{{ ani.id }}" name="new_name" value="{{ ani.name }}" required
                            class="flex-1 bg-gray-900 text-white px-3 py-2 rounded border border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500">
                        <button type="submit"
                            class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-white font-bold text-sm whitespace-nowrap">ì €ì¥</button>
                        <button type="button" onclick="toggleEdit('{{ ani.id }}')"
                            class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded text-gray-200 text-sm whitespace-nowrap">ì·¨ì†Œ</button>
                    </form>

                </li>
                {% else %}
                <li class="p-8 text-center text-gray-500">ë“±ë¡ëœ ì• ë‹ˆë©”ì´ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</body>

</html>